#!/bin/bash
site_lisp_path=$(cd $(dirname $0); pwd)

android_path="$site_lisp_path/android.el"
android_download=""
android_install=""

anything_path="$site_lisp_path/anything.el"
anything_download="wget http://www.emacswiki.org/emacs/download/anything.el"
anything_install=""

auto_complete_path="$site_lisp_path/auto-complete-1.3/"
auto_complete_download="wget http://cx4a.org/pub/auto-complete/auto-complete-1.3.tar.bz2"
auto_complete_install="tar xjf auto-complete-1.3.tar.bz2"

cedet_path="$site_lisp_path/cedet-1.0/"
cedet_download="wget http://sourceforge.net/projects/cedet/files/cedet/cedet-1.0.tar.gz/download"
cedet_install="tar xzf cedet-1.0.tar.gz"

ecb_path="$site_lisp_path/ecb/"
ecb_download="cvs -d:pserver:anonymous@ecb.cvs.sourceforge.net:/cvsroot/ecb login"
ecb_install="cvs -z3 -d:pserver:anonymous@ecb.cvs.sourceforge.net:/cvsroot/ecb co ecb"

geben_path="$site_lisp_path/geben/"
geben_download="svn co http://geben-on-emacs.googlecode.com/svn/trunk/ geben"
geben_install=""

highlight_symbol_path="$site_lisp_path/highlight-symbol.el"
highlight_symbol_download="wget http://nschum.de/src/emacs/highlight-symbol/highlight-symbol.el"
highlight_symbol_install=""

javascript_path="$site_lisp_path/javascript.el"
javascript_download="wget http://www.brgeight.se/downloads/emacs/javascript.el"
javascript_install=""

jdee_path="$site_lisp_path/jdee/"
jdee_download="svn co https://jdee.svn.sourceforge.net/svnroot/jdee/trunk/jdee/lisp jdee"
jdee_install=""

nxhtml_path="$site_lisp_path/nxhtml/"
nxhtml_download="wget http://ourcomments.org/Emacs/DL/elisp/nxhtml/zip/nxhtml-2.08-100425.zip"
nxhtml_install="unzip nxhtml-2.08-100425.zip"

ruby_debug_path="$site_lisp_path/ruby-debug/"
ruby_debug_download="svn co http://ruby-debug.rubyforge.org/svn/trunk/emacs ruby-debug"
ruby_debug_install=""

ruby_mode_path="$site_lisp_path/ruby-mode/"
ruby_mode_download="svn co http://svn.ruby-lang.org/repos/ruby/trunk/misc ruby-mode"
ruby_mode_install=""

w3m_path="$site_lisp_path/emacs-w3m/"
w3m_download="cvs -d :pserver:anonymous@cvs.namazu.org:/storage/cvsroot login"
w3m_install="cvs -d :pserver:anonymous@cvs.namazu.org:/storage/cvsroot co emacs-w3m"

xcode_document_path="$site_lisp_path/emacs-xcode-document-viewer/"
xcode_document_download="git clone http://github.com/imakado/emacs-xcode-document-viewer.git"
xcode_document_install="patch -p1 -d $site_lisp_path/emacs-xcode-document-viewer -i $site_lisp_path/xcode-document-viewer.patch"

xcscope_path="$site_lisp_path/xcscope.el"
xcscope_download="wget http://cscope.cvs.sourceforge.net/viewvc/cscope/cscope/contrib/xcscope/xcscope.el"
xcscope_install=""

all="android anything auto-complete ecb highlight-symbol javascript jdee nxhtml ruby-debug ruby-mode w3m xcode-document xcscope"

usage() {
	echo Emacs Lisp Installation Tool
	echo 
	echo Usage: elit package-name
	echo
	echo Packages:
	echo "  all(all packages)"
	echo "  android"
	echo "  anything"
	echo "  auto-complete"
	echo "  ecb"
	echo "  geben"
	echo "  highlight-symbol"
	echo "  javascript"
	echo "  jdee"
	echo "  nxhtml"
	echo "  ruby-debug"
	echo "  ruby-mode"
	echo "  w3m"
	echo "  xcode-document"
	echo "  xcscope"
}

install() {
	if [ -z "$1" ]; then
		return 1
	fi

	pkg_name=${1/-/_}

	eval path=\$${pkg_name}_path
	if [ -e $path ]; then
		echo "$1 already installed!!!"
		return 3
	fi
	
	echo "---> $1 installing..."

	eval download=\$${pkg_name}_download
	if [ -n "$download" ]; then
		echo "---> $download"
		ret=$($download)
		if [ $? -ne 0 ]; then
			echo "---> ERROR: failed to download $pkg_name"
			exit
		fi
	fi
	
	eval install=\$${pkg_name}_install
	if [ -n "$install" ]; then
		echo "---> $install"
		ret=$($install)
		if [ $? -ne 0 ]; then
			echo "---> ERROR: failed to install $pkg_name"
			exit
		fi
	fi

	echo "---> $1 successfully installed."
	return 0;
}

if [ $# -eq 0 ]; then
	usage
	exit
fi
cd $site_lisp_path

case "$1" in
	"all")
		for pkg in $all; do
			install $pkg
		done
		;;
	"android")
		install "$1"
		;;
	"anything")
		install "$1"
		;;
	"auto-complete")
		install "$1"
		;;
	"ecb")
		install "cedet"
		install "$1"
		;;
	"geben")
		install "$1"
		;;
	"highlight-symbol")
		install "$1"
		;;
	"javascript")
		install "$1"
		;;
	"jdee")
		install "ecb"
		install "$1"
		;;
	"nxhtml")
		install "$1"
		;;
	"ruby-debug")
		install "$1"
		;;
	"ruby-mode")
		install "$1"
		;;
	"w3m")
		install "$1"
		;;
	"xcode-document")
		install "w3m"
		install "anything"
		install "$1"
		;;
	"xcscope")
		install "$1"
		;;
	*)
		usage
		;;
esac
